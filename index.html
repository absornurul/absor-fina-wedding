<script>
document.addEventListener("DOMContentLoaded", function () {

  /* ===============================
     MUSIK & MODE GELAP
  ================================ */
  const bgm = document.getElementById("bgm");
  let playing = false;

  window.openInvite = function () {
    document.getElementById("hero").style.display = "none";
    document.getElementById("content").style.display = "block";
    bgm.play().catch(()=>{});
    playing = true;
    window.scrollTo(0,0);
  };

  window.toggleMusic = function () {
    playing ? bgm.pause() : bgm.play();
    playing = !playing;
  };

  window.toggleDark = function () {
    document.body.classList.toggle("dark");
  };

  /* ===============================
     AUTO NAMA TAMU (HAPUS _ & +)
  ================================ */
  const params = new URLSearchParams(window.location.search);
  let namaTamu = "Bapak/Ibu/Saudara/i";

  if (params.get("to")) {
    namaTamu = decodeURIComponent(params.get("to"))
      .replace(/[_+]/g, " ")
      .toLowerCase()
      .replace(/\b\w/g, c => c.toUpperCase());
  }

  const guest = document.getElementById("guest");
  const personalMessage = document.getElementById("personalMessage");

  if (guest) guest.innerText = namaTamu;

  const pesanDefault =
    `Merupakan suatu kehormatan bagi kami apabila ${namaTamu} berkenan hadir dan memberikan doa restu.`;

  if (personalMessage) {
    personalMessage.innerText = params.get("pesan")
      ? decodeURIComponent(params.get("pesan")).replace(/[_+]/g," ")
      : pesanDefault;
  }

  /* ===============================
     LINK WHATSAPP UNDANGAN
  ================================ */
  const noAdmin = "6283890194095"; // GANTI JIKA PERLU

  const pesanWA =
`Assalamu’alaikum Warahmatullahi Wabarakatuh

Yth. ${namaTamu},

Dengan memohon rahmat Allah SWT, kami mengundang
Bapak/Ibu/Saudara/i untuk menghadiri acara pernikahan kami.

Silakan buka undangan berikut:
${window.location.href}

Merupakan suatu kehormatan bagi kami apabila ${namaTamu}
berkenan hadir dan memberikan doa restu.

Wassalamu’alaikum Warahmatullahi Wabarakatuh`;

  window.waUndangan =
    `https://wa.me/${noAdmin}?text=${encodeURIComponent(pesanWA)}`;

  /* ===============================
     COUNTDOWN
  ================================ */
  const target = new Date("2026-01-28T09:00:00+07:00").getTime();

  setInterval(() => {
    const diff = target - Date.now();
    if (diff <= 0) return;

    document.getElementById("d").innerText = Math.floor(diff / 86400000);
    document.getElementById("h").innerText = Math.floor(diff / 3600000) % 24;
    document.getElementById("m").innerText = Math.floor(diff / 60000) % 60;
    document.getElementById("s").innerText = Math.floor(diff / 1000) % 60;
  }, 1000);

  /* ===============================
     TANGGAL HIJRIAH & JAWA
  ================================ */
  const acara = new Date("2026-01-28T09:00:00+07:00");

  document.getElementById("tanggalHijriah").innerText =
    new Intl.DateTimeFormat(
      "id-ID-u-ca-islamic",
      { day:"numeric", month:"long", year:"numeric" }
    ).format(acara) + " H";

  const hari = ["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];
  const pasaran = ["Legi","Pahing","Pon","Wage","Kliwon"];
  const ref = new Date(1970,0,1);

  document.getElementById("tanggalJawa").innerText =
    `${hari[acara.getDay()]} ${pasaran[Math.floor((acara-ref)/86400000)%5]}`;

  /* ===============================
     RSVP WHATSAPP
  ================================ */
  window.sendRSVP = function () {
    const t =
`Nama: ${rsvpName.value}
Kehadiran: ${rsvpStatus.value}
Ucapan:
${rsvpMsg.value}`;

    window.open(
      "https://wa.me/6283890194095?text=" + encodeURIComponent(t),
      "_blank"
    );
  };

  window.copyText = function (t) {
    navigator.clipboard.writeText(t);
    alert("Berhasil disalin");
  };

  /* ===============================
     ANIMASI SCROLL
  ================================ */
  document.querySelectorAll("section").forEach(sec => {
    new IntersectionObserver(e =>
      e.forEach(x => x.isIntersecting && x.target.classList.add("active")),
      { threshold: 0.3 }
    ).observe(sec);
  });

});
</script>
